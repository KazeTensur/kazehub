-- ================= KAZEHUB AAA UI + LUCIDE + GRADIENT =================
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

-- Window
local Window = Rayfield:CreateWindow({
    Name = "‚ú® KazeHub AAA",
    Icon = "lucide-rocket",
    LoadingTitle = "Welcome to KazeHub!",
    LoadingSubtitle = "by Kaze",
    ConfigurationSaving = {Enabled=true, FolderName="Kazehub", FileName="kazehub"}
})

-- ================= SERVICES =================
local Players = game:GetService("Players")
local lp = Players.LocalPlayer
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local VirtualUser = game:GetService("VirtualUser")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")

local RemoteEvent = game:GetService("ReplicatedStorage"):WaitForChild("API"):WaitForChild("Utils"):WaitForChild("network"):WaitForChild("RemoteEvent")
local WorldsFolder = workspace:WaitForChild("Worlds", 10)

local s_request
pcall(function() s_request = http_request end)
pcall(function() if not s_request then s_request = request end end)
pcall(function() if not s_request and http then s_request = http.request end end)

-- ================= STATE =================
local SelectedMode, SelectedMap, SelectedAct, SelectedDifficulty = "Story", nil, "1", "Normal"
local WebhookEnabled, customWebhook = true, ""

-- Load webhook if exists
pcall(function() if isfile("custom_webhook.txt") then customWebhook = readfile("custom_webhook.txt") end end)

-- ================= HELPERS =================
local function getSortedMaps()
    local list = {}
    for _, m in ipairs(WorldsFolder:GetChildren()) do table.insert(list,m.Name) end
    table.sort(list)
    return list
end
local function isPlayerInBattle()
    local gui = lp.PlayerGui:FindFirstChild("battle")
    return gui and gui.Enabled
end

-- ================= RESULT UI =================
local resultUI = lp.PlayerGui:WaitForChild("battle"):WaitForChild("Result")
local content = resultUI:WaitForChild("Base"):WaitForChild("Content")
local resultLabel  = content:WaitForChild("Result")
local rewardFolder = content:WaitForChild("Rewards")
local stageLabel   = content:WaitForChild("Stage")

-- ================= WEBHOOK CORE =================
local function getMatchRewards()
    local rewards = {}
    for _, item in ipairs(rewardFolder:GetChildren()) do
        local qty = item:FindFirstChild("Quantity")
        if qty and qty:IsA("TextLabel") and qty.Text~="" then
            table.insert(rewards,"‚Ä¢ **"..item.Name.."**: "..qty.Text)
        end
    end
    return #rewards>0 and table.concat(rewards,"\n") or "Kh√¥ng c√≥ ph·∫ßn th∆∞·ªüng"
end
local function sendResultWebhook()
    if not WebhookEnabled or customWebhook=="" or type(s_request)~="function" then return end
    local data=lp:FindFirstChild("Data")
    local coins=data and data:FindFirstChild("Coins")
    local gems=data and data:FindFirstChild("Gems")
    local balanceText=string.format("üí∞ Coins: %s\nüíé Gems: %s",coins and coins.Value or 0,gems and gems.Value or 0)
    local itemsFolder=lp.PlayerGui:FindFirstChild("main") and lp.PlayerGui.main:FindFirstChild("Inventory") and lp.PlayerGui.main.Inventory:FindFirstChild("Base") and lp.PlayerGui.main.Inventory.Base:FindFirstChild("Content") and lp.PlayerGui.main.Inventory.Base.Content:FindFirstChild("Items")
    local traitText=""
    if itemsFolder then
        local traitTokens=itemsFolder:FindFirstChild("Trait Tokens")
        local ice=itemsFolder:FindFirstChild("Ice")
        local stocking=itemsFolder:FindFirstChild("Christmas Stocking")
        traitText=string.format("üéØ Trait Tokens: %s\n‚ùÑÔ∏è Ice: %s\nüéÅ Christmas Stocking: %s",
            traitTokens and traitTokens:FindFirstChild("Quantity") and traitTokens.Quantity.Text or "0",
            ice and ice:FindFirstChild("Quantity") and ice.Quantity.Text or "0",
            stocking and stocking:FindFirstChild("Quantity") and stocking.Quantity.Text or "0")
    else traitText="üéØ Trait Tokens: 0\n‚ùÑÔ∏è Ice: 0\nüéÅ Christmas Stocking: 0" end
    local rewardText=getMatchRewards()
    local proxyUrl=customWebhook:gsub("discord.com","webhook.lewisakura.moe")
    local payload={
        content="KazeHub Match Result",
        embeds={{title=(resultLabel.Text:lower():find("win") or resultLabel.Text:lower():find("victory")) and "üèÜ VICTORY" or "üíÄ DEFEAT",
            color=(resultLabel.Text:lower():find("win") or resultLabel.Text:lower():find("victory")) and 3066993 or 15158332,
            description="üë§ Player: **"..lp.Name.."**\nüó∫ Stage: **"..stageLabel.Text.."**",
            fields={{name="üéÅ Rewards",value=rewardText,inline=false},{name="üí∞ Balance",value=balanceText,inline=false},{name="üõ†Ô∏è Items",value=traitText,inline=false}},
            footer={text="‚ú® KazeHub | Delta X Safe"}}}
    }
    task.spawn(function()
        pcall(function() s_request({Url=proxyUrl,Method="POST",Headers={["Content-Type"]="application/json"},Body=HttpService:JSONEncode(payload)}) end)
    end)
end

-- ================= RESULT UI TRIGGER =================
local sent=false
resultUI:GetPropertyChangedSignal("Visible"):Connect(function()
    if resultUI.Visible then
        if sent then return end
        sent=true
        task.wait(2)
        sendResultWebhook()
        print("üì® Webhook sent via Result UI")
    else sent=false end
end)

-- ================= HELPER GRADIENT TOGGLE =================
local function createGradientToggle(tab, name, default, flag, icon, callback)
    tab:CreateToggle({
        Name=name,
        CurrentValue=default,
        Flag=flag,
        Icon=icon,
        Callback=function(v)
            -- Gradient + hover effect (via Rayfield) - gi·∫£ l·∫≠p b·∫±ng m√†u
            local toggleUI=tab.Flags[flag].Toggle
            if toggleUI then
                toggleUI.BackgroundColor3=v and Color3.fromRGB(72,196,255) or Color3.fromRGB(100,100,100)
                toggleUI.MouseEnter:Connect(function()
                    toggleUI.BackgroundColor3=v and Color3.fromRGB(100,225,255) or Color3.fromRGB(150,150,150)
                end)
                toggleUI.MouseLeave:Connect(function()
                    toggleUI.BackgroundColor3=v and Color3.fromRGB(72,196,255) or Color3.fromRGB(100,100,100)
                end)
            end
            callback(v)
        end
    })
end

-- ================= MAIN TAB =================
local Main=Window:CreateTab("Lobby / Farm","lucide-map")
Main:CreateLabel("Mode / Map Selection")
Main:CreateDropdown({Name="Select Mode",Options={"Story","Raid"},CurrentOption={"Story"},Flag="Mode",Icon="lucide-star",Callback=function(opt) SelectedMode=opt[1] end})
Main:CreateDropdown({Name="Select Map",Options=getSortedMaps(),CurrentOption={getSortedMaps()[1]},Flag="Map",Icon="lucide-map-pin",Callback=function(opt) SelectedMap=opt[1] end})
Main:CreateDropdown({Name="Select Act",Options={"1","2","3","4","5","6","7","8","9","10"},CurrentOption={"1"},Flag="Act",Icon="lucide-hash",Callback=function(opt) SelectedAct=opt[1] end})
Main:CreateDropdown({Name="Difficulty",Options={"Normal","Hard","Nightmare"},CurrentOption={"Normal"},Flag="Difficulty",Icon="lucide-sliders",Callback=function(opt) SelectedDifficulty=opt[1] end})
createGradientToggle(Main,"Auto Join & Start",false,"AutoJoinStart","lucide-rocket",function(v)
    if v and not isPlayerInBattle() then
        RemoteEvent:FireServer("battle_start","story",SelectedMap,tonumber(SelectedAct),SelectedDifficulty)
    end
end)

-- ================= CHALLENGE TAB =================
local ChallengeTab=Window:CreateTab("Challenges","lucide-shield")
ChallengeTab:CreateLabel("Requires saved team in SLOT 1")
local AutoChallengeEnabled=false
local AutoEquipTeam=false
local IgnoredDebuffs={}
createGradientToggle(ChallengeTab,"Auto Equip Team (Slot 1)",false,"AutoEquipTeam","lucide-shield-check",function(v) AutoEquipTeam=v end)
ChallengeTab:CreateDropdown({Name="Ignore Debuffs",Options={"Double Stats","Weakened Units","Burn Enemies","Poison Enemies"},MultipleOptions=true,CurrentOption={},Flag="IgnoredDebuffs",Icon="lucide-x-circle",Callback=function(opts) IgnoredDebuffs=opts end})
local StatusLabel=ChallengeTab:CreateLabel("Status: Waiting...")

-- ================= GAMEPLAY TAB =================
local GameplayTab=Window:CreateTab("Gameplay","lucide-dice-5")
GameplayTab:CreateLabel("Summon / Spinner Settings")
local SelectedGameplay="x10 Summon Banner"
local AutoSpinEnabled=false
local SpinDelay=1.5
GameplayTab:CreateDropdown({Name="Select Action",Options={"x10 Summon Banner","Christmas Standard Spin","Christmas Advanced Spin"},CurrentOption={"x10 Summon Banner"},MultipleOptions=false,Flag="GameplayAction",Icon="lucide-dice-5",Callback=function(opt) SelectedGameplay=opt[1] end})
GameplayTab:CreateInput({Name="Spin Delay (seconds)",PlaceholderText="VD: 1.5 (0.3-60)",CurrentValue=tostring(SpinDelay),RemoveTextAfterFocusLost=false,Icon="lucide-clock",Callback=function(txt) local v=tonumber(txt) if v and v>0 then SpinDelay=math.clamp(v,0.3,60) else Rayfield:Notify({Title="Invalid Delay",Content="Delay ph·∫£i >0",Duration=2}) end end})
createGradientToggle(GameplayTab,"Auto Spin / Summon",false,"AutoGameplay","lucide-refresh-cw",function(v) AutoSpinEnabled=v if v then task.spawn(function() while AutoSpinEnabled do if SelectedGameplay then RemoteEvent:FireServer("summon_roll","Standard",10) end task.wait(SpinDelay) end end) end end)

-- ================= WEBHOOK TAB =================
local WebTab=Window:CreateTab("Webhook","lucide-link")
createGradientToggle(WebTab,"Enable Webhook",true,"WebhookEnable","lucide-check-circle",function(v) WebhookEnabled=v end)
WebTab:CreateInput({Name="Webhook URL",CurrentValue=customWebhook,PlaceholderText="Paste Discord webhook",Icon="lucide-link",Callback=function(txt) customWebhook=txt end})
WebTab:CreateButton({Name="Save Webhook",Icon="lucide-floppy-disk",Callback=function() writefile("custom_webhook.txt",customWebhook) Rayfield:Notify({Title="Saved",Content="Webhook saved",Duration=2}) end})
WebTab:CreateButton({Name="Test Webhook",Icon="lucide-check-circle",Callback=function()
    if customWebhook=="" then Rayfield:Notify({Title="Webhook Error",Content="Webhook URL tr·ªëng",Duration=2}) return end
    if type(s_request)~="function" then Rayfield:Notify({Title="HTTP Error",Content="Executor kh√¥ng h·ªó tr·ª£ HTTP Request",Duration=3}) return end
    local testEmbed={title="KazeHub Webhook Test", description="Webhook ho·∫°t ƒë·ªông th√†nh c√¥ng!\n\nüë§ Player: **"..lp.Name.."**\n‚è± Time: "..DateTime.now():FormatLocalTime("LLL","en-us"), color=3447003, footer={text="KazeHub Test"}}
    local ok,err=pcall(function() s_request({Url=customWebhook, Method="POST", Headers={["Content-Type"]="application/json"}, Body=HttpService:JSONEncode({username="KazeHub",embeds={testEmbed}})}) end)
    Rayfield:Notify({Title=ok and "Success" or "Failed", Content=ok and "Test webhook sent!" or tostring(err), Duration=2})
end})

-- ================= MISC TAB =================
local Misc=Window:CreateTab("Misc","lucide-settings")
Misc:CreateLabel("Performance Settings")
createGradientToggle(Misc,"FPS Boost",false,"FPSBoost","lucide-zap",function(v)
    if v then
        settings().Rendering.QualityLevel=1
        Lighting.GlobalShadows=false
        for _,obj in ipairs(Workspace:GetDescendants()) do if obj:IsA("BasePart") then obj.Material=Enum.Material.Plastic obj.Reflectance=0 end end
    end
end)
createGradientToggle(Misc,"Anti-AFK",false,"AntiAFK","lucide-awake",function(v)
    if v then _G.AFK=lp.Idled:Connect(function() VirtualUser:CaptureController() VirtualUser:ClickButton2(Vector2.new(0,0)) end) else if _G.AFK then _G.AFK:Disconnect() end end
end)
Misc:CreateButton({Name="Save Config Now",Icon="lucide-floppy-disk",Callback=function() Rayfield:SaveConfiguration() Rayfield:Notify({Title="Config",Content="Saved successfully",Duration=2}) end})
Misc:CreateButton({Name="Rejoin",Icon="lucide-refresh-cw",Callback=function() TeleportService:Teleport(game.PlaceId,lp) end})

Rayfield:LoadConfiguration()
print("‚úÖ KAZEHUB AAA UI LOADED")
